{% extends 'base.html' %}
{% load static %}

{% block title %}AllRicavi{% endblock title %}

{% block name %}TABELLA DEI RICAVI{% endblock %}

{% block scripts %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script type="text/javascript">
    function selectAll(){
				var items=document.getElementsByName('b1');
				for(var i=0; i<items.length; i++){
					if(items[i].type=='checkbox')
						items[i].checked=true;
				}
			}

			function unSelectAll(){
				var items=document.getElementsByName('b1');
				for(var i=0; i<items.length; i++){
					if(items[i].type=='checkbox')
						items[i].checked=false;
				}
			}

			function getSelected(){
				var checks=document.getElementsByName('b1');
				var list = new Array();
				for(var i=0; i<checks.length; i++){
					if(checks[i].checked== true){
						list.push(checks[i].value);
					}
				}
				return list;
			}

            function deleteGroup(){
                  var list=getSelected();
                  if(list.length > 0){
                    if(confirm('Are you sure you want to delete this Ricavi?')== true){
                        $.ajax({
                            type: "POST",
                            url: "/DeleteRicaviGroup/",
                            data: {
                                'list': list,
                                csrfmiddlewaretoken: '{{ csrf_token }}'
                            },
                            success: function(response) {
                                location.reload(true);

                            },
                            error: function(response){
                                alert("failure");
                            }
                        });
                    }
                  }
            }

    </script>
{% endblock %}

{% block content %}

        {% if messages %}
            <ul class="messages">
                {% for message in messages %}
                <font color="red"><li>{{ message }}</li></font>
                {% endfor %}
            </ul>
        {% endif %}

        <form method="get">
            <!--{{ filter.form.as_table }}-->
            <table border="5">
            {% for field in filter.form %}
                {% if forloop.counter|divisibleby:"3" %}
                    <tr>{{ field.label }} {{ field }}</tr></br></br>
                {% else %}
                    <tr>{{ field.label }} {{ field }}</tr>&nbsp;&nbsp;&nbsp;
                {% endif %}

            {% endfor %}
            </table></br>
            <button type="submit">Filtra</button>
        </form>

        </br>

        <div align="left">

            <input type="button" onclick='selectAll()' value="Select All"/>
            <input type="button" onclick='unSelectAll()' value="Unselect All"/>
            <input type="button" onclick='deleteGroup()' value="Delete Selected"/>

        </div>

        </br>
        <table width="100%" border="1" cellpadding="10" cellspacing="0">
            <tr>
                <th></th>
                <th>data</th>
                <th>movimento</th>
                <th>importo</th>
                <th>fattura</th>
                <th>intestatario fattura</th>
                <th>protocollo</th>
                <th colspan="2">Operation</th>
            </tr>
            {% for b in filter.qs %}
            <tr>
                <td>
                    <input type="checkbox" class="checks" name="b1" value={{b.id}}>
                </td>
                <td>{{ b.data }}</td>
                <td>{{ b.movimento }}</td>
                <td>{{ b.importo }} â‚¬</td>
                <td>{{ b.fattura }}</td>
                <td>{{ b.intestatario_fattura }}</td>
                <td>{{ b.protocollo }}</td>
                <td align="center"><a href="/UpdateRicavo/{{ b.id }}" class="btn btn-success btn-sm" role="button" aria-pressed="true">UPDATE</a></td>
                <td align="center"><a href="/DeleteRicavo/{{ b.id }}" class="btn btn-danger btn-sm" role="button" aria-pressed="true" onclick="return confirm('Are you sure you want to delete this Ricavo?')">DELETE</a></td>
            </tr>
            {% endfor %}
        </table>
        <div class="alert alert-primary" role="alert">
            Totale degli importi: <a href="#" class="alert-link">{{sum_r}}</a>
        </div>
{% endblock %}
