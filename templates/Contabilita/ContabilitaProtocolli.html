{% extends 'base.html' %}
{% load static %}
{% block title %}ContabilitaProtocolli{% endblock title %}
{% block name %}<i>CONTABILITA' DEI PROTOCOLLI</i>{% endblock %}
{% block content %}
    <table align="left" style="width:100%">
        <tr>
            <form method="post" action="{% url 'ContabilitaProtocolli' %}">
                {% csrf_token %}
                <b>Cliente </b>
                <input id="cliente_filter" type="text" name="filter" value="{{ cliente_filter }}"></br></br>
                <button type="submit" class="btn btn-light" onclick="cacheFilter()"><i class="fa fa-filter" aria-hidden="true"></i> Filtra</button>
            </form>
        </tr>
        <tr>
            <td>
                <div align="right">
                <form method="post" action="{% url 'export_output_table_xls' numquery=4 data_inizio='no' data_fine='no' %}">
                    {% csrf_token %}
                    <input type="hidden" name="filter" id="box_filter">
                    <input type="text" name="fname" placeholder="NomeDelFile" required>
                    <button type="submit" class="btn btn-primary"><i class="fa fa-download"></i> Scarica Excel</button>
                </form>
                </div>
            </td>
        </tr>
    </table>

    <div style="height:500px; overflow-x:scroll; overflow-y:scroll; border:1px solid black;">
        <table class="tabella-con-bordi" width="100%" border="1" cellpadding="5" cellspacing="0">
            <thead bgcolor="#383838" style="color:white; position: sticky; top: 0; z-index: 100;">
                <tr>
                    <th>Identificativo</th>
                    <th>Cliente</th>
                    <th>Indirizzo</th>
                    <th>Pratica</th>
                    <th>Parcella</th>
                    <th>Entrate</th>
                    <th>Uscite</th>
                    <th>Saldo</th>
                </tr>
            </thead>
            <tbody bgcolor="#585858" style="color:white;">
                {% for item in tabella_output4 %}
                <tr>
                    <td style='width: 35px; overflow: auto'>
                        <a href="{% url 'UpdateProtocol' id=item.0 %}">
                            {{ item.1 }}
                        </a>
                    </td>
                    <td style='width: 200px;'>
                        <a href="{% url 'AllClienti' %}?nominativo={{ item.2 }}">
                            {{ item.2 }}
                        </a>
                    </td>
                    <td>{{ item.4 }}</td>
                    <td>{{ item.5 }}</td>
                    <td>{{ item.6 }} €</td>
                    <td>{{ item.7 }} €</td>
                    <td>{{ item.8 }} €</td>
                    <td>{{ item.9 }} €</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="alert alert-primary" role="alert">
        Saldo Totale: <a href="#" class="alert-link">{{ tot_saldo }} €</a>
    </div>
    <script>

        function cacheFilter() {
            let filter_val = document.getElementById("cliente_filter").value;
            localStorage.setItem('filter', filter_val);
        }

        window.onload = function(){
            let filter_val = localStorage.getItem('filter'); // or localStorage.value
            document.getElementById("box_filter").value = filter_val;
        }

    </script>
{% endblock %}

