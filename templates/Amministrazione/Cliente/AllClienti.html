{% extends 'base4.html' %}
{% load static %}
{% block title %}AllClienti{% endblock title %}
{% block name %}TABELLA DEI CLIENTI{% endblock %}
{% block scripts %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script type="text/javascript">
        	function selectAll(){
				var items=document.getElementsByName('b1');
				for(var i=0; i<items.length; i++){
					if(items[i].type=='checkbox')
						items[i].checked=true;
				}
			}
			function unSelectAll(){
				var items=document.getElementsByName('b1');
				for(var i=0; i<items.length; i++){
					if(items[i].type=='checkbox')
						items[i].checked=false;
				}
			}
			function getSelected(){
				var checks=document.getElementsByName('b1');
				var list = new Array();
				for(var i=0; i<checks.length; i++){
					if(checks[i].checked== true){
						list.push(checks[i].value);
					}
				}
				return list;
			}
            function deleteGroup(){
                  var list=getSelected();
                  if(list.length > 0){
                    if(confirm('Sei sicuro di voler eliminare questi Clienti ?')== true){
                        $.ajax({
                            type: "POST",
                            url: "/DeleteClientiGroup/",
                            data: {
                                'list': list,
                                csrfmiddlewaretoken: '{{ csrf_token }}'
                            },
                            success: function(response) {
                                location.reload(true);
                            },
                            error: function(response){
                                alert("failure");
                            }
                        });
                    }
                  }
            }
    </script>
{% endblock %}

{% block content %}
    <form method="get">
        <table border="5">
        {% for field in filter.form %}
            {% if forloop.counter|divisibleby:"2" %}
                <tr>{{ field.label }} {{ field }}</tr></br></br>
            {% else %}
                <tr>{{ field.label }} {{ field }}</tr>&nbsp;&nbsp;&nbsp;
            {% endif %}
        {% endfor %}
        </table></br>
        <button type="submit">Filtra</button>
    </form>
    </br>
    <table align="left" style="width:100%">
        <tr>
            <td>
                <input type="button" onclick='selectAll()' value="Seleziona Tutti"/>
                <input type="button" onclick='unSelectAll()' value="Deseleziona Tutti"/>
                <input type="button" onclick='deleteGroup()' value="Elimina Selezionati"/>
            </td>
            <td>
                <div align="right">
                <form method="post" action="{% url 'export_input_table_xls' list=filter.qs model='rubricaclienti' %}">
                    {% csrf_token %}
                     <input type="text" name="fname" placeholder="<NomeFile>" required>
                    <button type="submit">DOWNLOAD Excel</button>
                </form>
                </div>
            </td>
        </tr>
    </table>

    <table width="100%" border="1" cellpadding="5" cellspacing="0">
        <tr>
            <th></th>
            <th>nominativo</th>
            <th>tel</th>
            <th>mail</th>
            <th>note</th>
            <th colspan="2">Operazioni</th>
        </tr>
        {% for b in filter_queryset %}
        <tr>
            <td style='width: 10px;'>
                <input type="checkbox" class="checks" name="b1" value={{b.id}}>
            </td>
            <td style='width: 250px; overflow: auto'>{{ b.nominativo }}</td>
            <td style='width: 150px; overflow: auto'>{{ b.tel }}</td>
            <td style='width: 250px; overflow: auto'>{{ b.mail }}</td>
            <td style='width: 300px; overflow: auto'>{{ b.note|safe }}</td>
            <td style='width: 15px;' align="center"><a href="/UpdateCliente/{{ b.id }}" class="btn btn-success btn-sm" role="button" aria-pressed="true">=></a></td>
            <td style='width: 15px;' align="center"><a href="/DeleteCliente/{{ b.id }}" class="btn btn-danger btn-sm" role="button" aria-pressed="true" onclick="return confirm('Sei sicuro di voler eliminare questo Cliente ?')">X</a></td>
        </tr>
        {% endfor %}
    </table>

<!--<div class="pagination">-->
        <!--<span class="step-links">-->
            <!--{% if cl.has_previous %}-->
                <!--<a href="?page=1">&laquo; Prima Pagina</a> /-->
                <!--<a href="?page={{ cl.previous_page_number }}">Precedente</a>-->
            <!--{% endif %}-->
            <!--<span class="current">-->
                <!--Page {{ cl.number }} of {{ cl.paginator.num_pages }}.-->
            <!--</span>-->
            <!--{% if cl.has_next %}-->
                <!--<a href="?page={{ cl.next_page_number }}">Successiva</a> /-->
                <!--<a href="?page={{ cl.paginator.num_pages }}">Ultima Pagina &raquo;</a>-->
            <!--{% endif %}-->
        <!--</span>-->
 <!--</div>-->
{% endblock %}
